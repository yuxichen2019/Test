<!DOCTYPE html>
<html>

	<head lang="en">
		<meta charset="UTF-8">
		<title>物联网卡管理平台</title>
		<link rel="icon" href="./assets/images/sohan.ico" />
		<link rel="stylesheet" type="text/css" href="./assets/css/init.css" />
		<link rel="stylesheet" type="text/css" href="./assets/css/login.css" />
		<link rel="stylesheet" type="text/css" href="./assets/css/c3Loading.css" />
	</head>

	<body>
		<!--banner图-->
		<div class="lg_banner" id="lg_banner">
			<img src="./assets/images/login_bgc2.png" alt="" style="width: 100%" />
			<div class="lg_banner_txt">
				<p class="lg_banner_p1">物联网卡管理平台</p>
				<p class="lg_banner_p2">SOHAN M2M CARD PLATFORM</p>
			</div>
		</div>
		<!--登陆框-->
		<div class="lg_login">
			<!--登陆-->
			<div class="containerLogin">
		        <!--用户名-->
		        <div class="lg_login_user">
		            <label class="lg_login_user_label" for="lg_user_input">
		                <svg t="1526889312695" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7228"  width="22" height="22">
		                    <path d="M621.8 601.2c86.8-49.5 146.1-141.9 146.1-249 0-158.9-128.8-287.7-287.7-287.7S192.5 193.3 192.5 352.2c0 107.1 59.2 199.5 146.1 249-150 54.5-259.7 192.7-272.3 358.3h63.9c16.2-178.9 166.9-319.6 350-319.6s333.8 140.7 350 319.6h63.9c-12.6-165.6-122.3-303.8-272.3-358.3z m-365.4-249c0-123.4 100.4-223.7 223.8-223.7S704 228.8 704 352.2 603.6 575.9 480.2 575.9 256.4 475.6 256.4 352.2z" p-id="7229" fill="#ffffff">
		                    </path>
		                </svg>
		            </label><input class="lg_login_user_input" id="lg_user_input" placeholder="请输入登陆账号" type="text" />
		        </div>
		        <!--密码-->
		        <div class="lg_login_pw">
		            <label class="lg_login_pw_label" for="lg_pw_input">
		                <svg t="1526889411282" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7945"  width="22" height="22">
		                    <path d="M832 960H192c-35.3 0-64-26.7-64-59.8v-448c0-33 28.7-59.7 64-59.7h640c35.3 0 64 26.7 64 59.7v448c0 33.1-28.7 59.8-64 59.8M512 541.9c-53 0-96 40.1-96 89.6 0 33.1 19.4 61.7 48 77.2V794c0 25.7 21.5 46.7 48 46.7s48-20.9 48-46.7v-85.3c28.6-15.5 48-44.1 48-77.2 0-49.5-43-89.6-96-89.6m0-388.3c-106 0-192 80.2-192 179.2h-96C224 184.3 352.9 64 512 64s288 120.3 288 268.8h-96c0-99-86-179.2-192-179.2m0 0" p-id="7946" fill="#ffffff">
		                    </path>
		                </svg>
		            </label><input class="lg_login_pw_input" id="lg_pw_input" placeholder="请输入密码" type="password" />
		        </div>
				<!--登陆-->
				<div class="lg_login_btn" style="width: 102%;">
					<div class="lg_login_btn_lg" id="login">
						登陆
					</div>
					<div class="lg_login_btn_set" id="reset">
						重置
					</div>
				</div>
				<!--忘记密码-->
				<!--<div class="lg_login_rmPw" id="rmPw">
					修改密码？
				</div>-->
			</div>
			<!--修改密码-->
			<div class="containerModifi" style="display: none">
				<!--用户名-->
				<div class="lg_login_user">
					<label class="lg_login_user_label" for="rp_user_input">
            </label><input class="lg_login_user_input" id="rp_user_input" placeholder="请输入登陆账号" type="text" />
				</div>
				<!--旧密码-->
				<div class="lg_login_pw">
					<label class="lg_login_pw_label" for="rp_pw_input_odd">
            </label><input class="lg_login_pw_input" id="rp_pw_input_odd" placeholder="请输入旧密码" type="password" />
				</div>
				<!--新密码-->
				<div class="lg_login_pw">
					<label class="lg_login_pw_label" for="rp_pw_input_new">
            </label><input class="lg_login_pw_input" id="rp_pw_input_new" placeholder="请输入新密码" type="password" />
				</div>
				<!--重复新密码-->
				<div class="lg_login_pw">
					<label class="lg_login_pw_label" for="rp_pw_input_new01">
            </label><input class="lg_login_pw_input" id="rp_pw_input_new01" placeholder="请重复输入新密码" type="password" />
				</div>
				<div class="lg_login_btn" style="width: 102%;">
					<div class="lg_login_btn_lg" id="sure">
						确定
					</div>
					<div class="lg_login_btn_set" id="resetRp">
						重置
					</div>
				</div>
				<!--忘记密码-->
				<div class="lg_login_rmPw" id="rmPw_l">
					登陆？
				</div>
			</div>

			<script src="incoming/1.0.0_gx_wlw/incoming/jquery-3.3.1.min.js"></script>
			<script src="incoming/1.0.0_gx_wlw/incoming/layerAll/layer.min.js"></script>
			<script src="incoming/1.0.0_gx_wlw/ssui.js"></script>
			<script src="./incoming/base64.js"></script>
			<script>
				var commonUrl = "";
//				var commonUrl = 'http://192.168.0.191:7300';
//				var commonUrl = 'http://127.0.0.1:8300';
//			    var commonUrl = 'http://192.168.0.130:8300';
				ss.imports(
					[
						'c3Loading' 
					],
					function() {
						//---------| 登陆 | --------
	                    //登陆函数
	                    function loginFn(){
	                    	if(ss.getDom('#lg_user_input').value && ss.getDom('#lg_pw_input').value){
	                    		$.ajax({
		                            url: commonUrl+'/index/User/checkLoginUser.action',
		                            type:'post',
		                            dataType:"json",
		                            contentType:"application/json",
		                            data:JSON.stringify({
		                            	"userName":ss.getDom('#lg_user_input').value
		                            }),
		                            success:function(res){
		                            	if(res.result==='success'){
		                            		$.ajax({
					                            url: commonUrl+'/index/login.action',
					                            type:'post',
					                            dataType:"json",
					                            contentType:"application/json",
					                            data:JSON.stringify({
					                            	"loginName":ss.getDom('#lg_user_input').value,
					                            	"loginPass":ss.getDom('#lg_pw_input').value 
					                            }),
					                            success:function(data){
					                                data.result == 'success'
					                                        ?
					//                                window.location.href = 'layout.html#supplierManagement'
					                                window.location.href = 'layout.html#account_info'
					                                :
					                                layer.msg(data.errorMsg,{
					                                    offset:'250px'
					                                })
					                            },
					                            beforeSend:function(request){
					                            	request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
					                                ss.c3Loading.show();
					                            },
					                            complete:function(){
					                                ss.c3Loading.hidden();
					                            }
					                        })
		                            	}
		                            	else{
					                        layer.msg(res.errorMsg,{
					                            offset:'250px'
					                        });
		                            	}
		                            },
		                            beforeSend:function(request){
		                            	request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
		                                ss.c3Loading.show();
		                            },
		                            complete:function(){
		                                ss.c3Loading.hidden();
		                            }
		                        })
	                    	}
	                    	else{
		                    	layer.msg('请检查账号或密码是否填写完整！',{
		                            offset:'250px'
		                        });
	                    	}
	 

	                    };
	                    //登陆按钮->点击事件
	                    ss.getDom('#login').addEventListener('click',function(){
	                        loginFn();
	                    });
	                    //回车登陆->点击事件
	                    document.onkeydown = function(event){
	                        if(event.keyCode == 13){
	                            loginFn();
	                        };;
	                    };
						
						
						//登陆重置
						ss.getDom('#reset').addEventListener('click', function() {
							ss.getDom('#lg_user_input').value = '';
							ss.getDom('#lg_pw_input').value = '';
						});
						//修改密码
//						ss.getDom('#rmPw').addEventListener('click', function() {
//							ss.getDom('.containerLogin').style.display = 'none';
//							ss.getDom('.containerModifi').style.display = 'block';
//						});

						//修改
						ss.getDom('#sure').addEventListener('click', function() {
							var isTF = true;
							var judgeArr = [{
									boolean: ss.getDom('#rp_user_input').value,
									tip: '请输入登陆账号'
								},
								{
									boolean: ss.getDom('#rp_pw_input_odd').value,
									tip: '请输入旧密码'
								},
								{
									boolean: ss.getDom('#rp_pw_input_new').value,
									tip: '请输入新密码'
								},
								{
									boolean: ss.getDom('#rp_pw_input_new').value.length >= 6,
									tip: '请保证新密码的长度在6位以上'
								},
								{
									boolean: ss.getDom('#rp_pw_input_new01').value,
									tip: '请重复输入新密码'
								},
								{
									boolean: ss.getDom('#rp_pw_input_new').value == ss.getDom('#rp_pw_input_new01').value,
									tip: '新密码两次输入不一致'
								},
							]
							for(var a = 0; a < judgeArr.length; a++) {
								if(!judgeArr[a].boolean) {
									layer.msg(judgeArr[a].tip);
									isTF = false;
									break;
								}
							}
							isTF && (function() {
								$.ajax({
									url: commonUrl + '/UserManagement/modifyPW',
									type: 'post',
									data: {
										accountId: ss.getDom('#rp_user_input').value,
										password: ss.getDom('#rp_pw_input_odd').value,
										newPassword: ss.getDom('#rp_pw_input_new01').value
									},
									success: function(data) {
										console.log(data);
										data.result == 'success' ?
											(layer.msg(data.message), ss.getDom('.containerLogin').style.display = 'block', ss.getDom('.containerModifi').style.display = 'none') :
											layer.msg(data.message)
									},
									beforeSend: function() {
										ss.c3Loading.show();
									},
									complete: function() {
										ss.c3Loading.hidden();
									}
								})
							}())
						});
						//修改重置
						ss.getDom('#resetRp').addEventListener('click', function() {
							ss.getDom('#rp_user_input').value = '';
							ss.getDom('#rp_pw_input_odd').value = '';
							ss.getDom('#rp_pw_input_new').value = '';
							ss.getDom('#rp_pw_input_new01').value = '';
						});
						//登陆
						ss.getDom('#rmPw_l').addEventListener('click', function() {
							ss.getDom('.containerLogin').style.display = 'block';
							ss.getDom('.containerModifi').style.display = 'none';
						});

					})
			</script>
		</div>
	</body>

</html>